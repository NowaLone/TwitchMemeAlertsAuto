<UserControl
    x:Class="TwitchMemeAlertsAuto.WPF.Views.LogView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:TwitchMemeAlertsAuto.WPF.Converters"
    xmlns:core="clr-namespace:TwitchMemeAlertsAuto.Core;assembly=TwitchMemeAlertsAuto.Core.Models"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:TwitchMemeAlertsAuto.WPF.Views"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:properties="clr-namespace:TwitchMemeAlertsAuto.WPF.Properties"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:vm="clr-namespace:TwitchMemeAlertsAuto.Core.ViewModels;assembly=TwitchMemeAlertsAuto.Core"
    d:DataContext="{d:DesignInstance Type=vm:LogViewModel}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    Loaded="LogView_Loaded"
    mc:Ignorable="d">
    <UserControl.Resources>
        <converters:DateToRelativeConverter x:Key="DateToRelativeConverter" />
        <converters:CollectionToVisibilityConverter x:Key="CollectionToVisibilityConverter" />
        <CollectionViewSource
            x:Key="LogGrouped"
            Filter="CollectionViewSource_Filter"
            IsLiveGroupingRequested="True"
            IsLiveSortingRequested="True"
            Source="{Binding Log}">
            <CollectionViewSource.GroupDescriptions>
                <PropertyGroupDescription PropertyName="Timestamp.Date" />
            </CollectionViewSource.GroupDescriptions>
            <d:CollectionViewSource.Source>
                <x:Array Type="{x:Type core:History}">
                    <core:History Message="Sample log message 1" />
                    <core:History Message="Sample log message 2" />
                    <core:History Message="Another day message" />
                </x:Array>
            </d:CollectionViewSource.Source>
        </CollectionViewSource>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
        </Grid.RowDefinitions>
        <GroupBox
            Grid.Row="0"
            Header="{x:Static properties:Resources.Search}"
            Visibility="{Binding Log, Converter={StaticResource CollectionToVisibilityConverter}}">
            <TextBox x:Name="FilterTextBox" TextChanged="FilterTextBox_TextChanged" />
        </GroupBox>
        <GroupBox Grid.Row="1" Header="{x:Static properties:Resources.LogHeader}">
            <ScrollViewer x:Name="LogScrollViewer">
                <ItemsControl x:Name="LogsItemsControl" ItemsSource="{Binding Source={StaticResource LogGrouped}}">
                    <ItemsControl.GroupStyle>
                        <GroupStyle>
                            <GroupStyle.HeaderTemplate>
                                <DataTemplate>
                                    <StackPanel>
                                        <Separator Margin="24,4" />
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontWeight="Bold"
                                            Text="{Binding Name, Converter={StaticResource DateToRelativeConverter}}"
                                            TextAlignment="Center" />
                                        <Separator Margin="24,4" />
                                    </StackPanel>
                                </DataTemplate>
                            </GroupStyle.HeaderTemplate>
                        </GroupStyle>
                    </ItemsControl.GroupStyle>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="core:History">
                            <TextBlock>
                                <Run Text="{Binding Timestamp, StringFormat=HH:mm}" />
                                <Run Text="{Binding Message}" />
                            </TextBlock>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </GroupBox>
    </Grid>
</UserControl>